<html>
    <head>
        <title>OSWorkflow - 
         Queries
        </title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <ul class="star">
<li> Back to <a href="5.3 Executing actions.html" title="5.3 Executing actions">5.3 Executing actions</a></li>
<li> Forward to <a href="5.5 Implicit vs Explicit Configuration.html" title="5.5 Implicit vs Explicit Configuration">5.5 Implicit vs Explicit Configuration</a></li>
</ul><br/>
OSWorkflow 2.6 introduces a new <a href="http://www.opensymphony.com/osworkflow/api/com/opensymphony/workflow/query/WorkflowExpressionQuery.html" title="Visit page outside Confluence">ExpressionQuery</a> API.<p class="paragraph">Note that not all workflow stores support queries. Currently the Hibernate, JDBC, and Memory workflow stores do support queries. The hibernate store however does not support mixed-type queries (for example, a query that uses both the history and current step contexts). To execute a query, a WorkflowExpressionQuery object is constructed, and the <a href="http://www.opensymphony.com/osworkflow/api/com/opensymphony/workflow/Workflow.html#query(com.opensymphony.workflow.query.WorkflowExpressionQuery)" title="Visit page outside Confluence">query</a> method is invoked on the Workflow object.</p>Below are some query example:<br/>

<div class="code"><div class="codeContent">
<pre><span class="java&#45;comment">//Get all workflow entry ID&#039;s <span class="java&#45;keyword">for</span> which the owner is &#039;testuser&#039;</span>&#10;<span class="java&#45;keyword">new</span> WorkflowExpressionQuery(&#10;  <span class="java&#45;keyword">new</span> FieldExpression(FieldExpression.OWNER, <span class="java&#45;comment">//Check the OWNER field</span>&#10;  FieldExpression.CURRENT&#95;STEPS,  <span class="java&#45;comment">//Look in the current steps context</span>&#10;  FieldExpression.EQUALS, <span class="java&#45;comment">//check equality</span>&#10;  <span class="java&#45;quote">&quot;testuser&quot;</span>)); <span class="java&#45;comment">//the equality value is &#039;testuser&#039;</span></pre>
</div></div><br/>

<div class="code"><div class="codeContent">
<pre><span class="java&#45;comment">//Get all workflow entry ID&#039;s that have the name &#039;myworkflow&#039;</span>&#10;<span class="java&#45;keyword">new</span> WorkflowExpressionQuery(&#10;  <span class="java&#45;keyword">new</span> FieldExpression(FieldExpression.NAME, <span class="java&#45;comment">//Check the NAME field</span>&#10;  FieldExpression.ENTRY,  <span class="java&#45;comment">//Look in the entries context</span>&#10;  FieldExpression.EQUALS,  <span class="java&#45;comment">//Check equality</span>&#10;  &#039;myworkflow&#039;)) <span class="java&#45;comment">//equality value is &#039;myworkflow&#039;</span></pre>
</div></div><p class="paragraph">Below is an example of a nested query:</p><div class="code"><div class="codeContent">
<pre><span class="java&#45;comment">// Get all finished workflow entries where the current owner is &#039;testuser&#039;</span>&#10;Expression queryLeft = <span class="java&#45;keyword">new</span> FieldExpression(&#10;  FieldExpression.OWNER, &#10;  FieldExpression.CURRENT&#95;STEPS, &#10;  FieldExpression.EQUALS, &#039;testuser&#039;);&#10;Expression queryRight = <span class="java&#45;keyword">new</span> FieldExpression(&#10;  FieldExpression.STATUS, &#10;  FieldExpression.CURRENT&#95;STEPS, &#10;  FieldExpression.EQUALS, &#10;  <span class="java&#45;quote">&quot;Finished&quot;</span>, &#10;  <span class="java&#45;keyword">true</span>);&#10;WorkflowExpressionQuery query = <span class="java&#45;keyword">new</span> WorkflowExpressionQuery(&#10;  <span class="java&#45;keyword">new</span> NestedExpression(<span class="java&#45;keyword">new</span> Expression&#91;&#93; &#123;queryLeft, queryRight&#125;,&#10;  NestedExpression.AND));</pre>
</div></div><p class="paragraph">Finally, here is an example of a mixed-context query. Note that this query is not supported by the Hibernate workflow store.</p><div class="code"><div class="codeContent">
<pre><span class="java&#45;comment">//Get all workflow entries that were finished in the past</span>&#10;<span class="java&#45;comment">//or are currently marked finished</span>&#10;Expression queryLeft = <span class="java&#45;keyword">new</span> FieldExpression(&#10;  FieldExpression.FINISH&#95;DATE, &#10;  FieldExpression.HISTORY&#95;STEPS, &#10;  FieldExpression.LT, <span class="java&#45;keyword">new</span> Date());&#10;Expression queryRight = <span class="java&#45;keyword">new</span> FieldExpression(&#10;  FieldExpression.STATUS, &#10;  FieldExpression.CURRENT&#95;STEPS, &#10;  FieldExpression.EQUALS, <span class="java&#45;quote">&quot;Finished&quot;</span>);&#10;WorkflowExpressionQuery query = <span class="java&#45;keyword">new</span> WorkflowExpressionQuery(&#10;  <span class="java&#45;keyword">new</span> NestedExpression(<span class="java&#45;keyword">new</span> Expression&#91;&#93; &#123;queryLeft, queryRight&#125;,&#10;  NestedExpression.OR));</pre>
</div></div>

                    			    </td>
		    </tr>
	    </table>
    </body>
</html>